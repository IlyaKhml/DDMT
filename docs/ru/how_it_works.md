<p align='center'>
    <b>RU</b> • <a href='../en/how_it_works.md'>EN</a> • <a href='../zh/how_it_works.md'>ZH</a>
</p>
<p align='center'>
    <a href='../../README.md'>Основное</a> • 
    <a href='settings.md'>Документация</a> • <b>Как это работает?</b> • <a href='qa.md'>Вопросы</a>
</p>

# Объяснение работы файлов локализации и ручной перевод
## Основы
Прежде всего, стоит удостовериться, что у мода есть файлы локализации (текст, который отображается в игре). Для этого нужно проверить наличие папки `localization` в папке мода. Если в ней есть файлы `.loc2` и `.xml`, то мод можно полностью или частично перевести на ваш язык.

| Файл:   | Функции:                                                                                                 | Наличие гарантирует:                                                    |
| ------- | -------------------------------------------------------------------------------------------------------- | ----------------------------------------------------------------------- |
| `.loc2` | Закодированный текст для игры, который нельзя перевести.                                                 | ✔️Частичный перевод (Замена голубых надписей на текст имеющегося языка) |
| `.xml`  | Строчки текста, которые используются для создания `.loc2` файлов. Текст можно перевести на другие языки. | ✔️Полный перевод мода                                                   |

## Наименование файлов 
Информация больше для тех, кто хочет делать перевод вручную.
> **Файлы локализации имеют особые части, которые не следует изменять!**

| Файл:   | Пример названия:          | Объяснение:                                                                                                                                                                                                                   |
| ------- | ------------------------- | ----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| `.loc2` | `2200558948_english.loc2` | Название файла задаётся автоматически `localization.exe`.                                                                                                                                                                     |
| `.xml`  | `test.string_table.xml`   | `test` - Произвольное название, не имеет особого значения.<br>`.string_table` - показывает, что этот файл содержит строки на перевод для создания loc2 файлов через `localization.exe` (без неё не найдёт `.xml` на перевод). |

## Создание перевода
Для начала выберите язык для создания перевода. Обычно существует один файл `.xml` в котором находятся все языки, но некоторые мододелы делают для каждого языка отдельный `.xml`. В таком случаи, можно создать новый файл с переводом, скопировать уже имеющийся `.xml` или вставить новый тег языка в уже существующий `.xml`:
`<language id=[Язык, поддерживаемый игрой]> </language>`.

Далее можно перевести в все строки на нужный вам язык и сохранить файл. 

## Конвертация `.xml` в `.loc2`
Для конвертации используется файл `localization.exe`, который находится в папке `_windows` в папке игры.

Примерный путь до файла:
 `G:\SteamLibrary\steamapps\common\DarkestDungeon\_windows\localization.exe

Для того, чтобы сконвертировать `.xml`, нужно поместить `localization.exe` и несколько других файлов из папки `_windows` (указаны ниже) в папку `localization` мода. 

> Важно, чтобы название папки, в которой проводится конвертации называлась именно `localization`, так как в противном случаи, `localization.exe` будет работать некорректно.

По итогу в папке должны находится следующие файлы:
* `Файл или несколько файлов .xml для создания .loc2`
* `localization.exe`
* `fmod.dll`
* `fmodstudio.dll`
* `glew32.dll`
* `SDL2.dll`
* `steam_api.dll`

Следующим шагом нужно открыть `localization.exe`, он создаст файлы локализации `.loc2` для игры.

## Добавление путей в `modfiles.txt` 
`.loc2` файлы созданы, но теперь игре нужно указать, какие файлы из мода должны быть загружены. За это отвечает `modfiles.txt`, который находится в корневой папке мода.

В нём указывается относительный путь до файла (относительно папки мода) и размер файла в байтах:
`project.xml 4585`

Размер файла, скорее всего нужен для мастерской steam, чтобы понимать какие файлы мода нужно скачать заново, если они будут повреждены.  

Сюда добавляем ссылки на новые `.loc2` файлы и размер файлов, например:
`localization/2200558948_russian.loc2 20232`
`localization/2200558948_english.loc2 20254`

## Редактирование `project.xml`
Последним шагом будет изменения названия мода в файле `project.xml` (находится в корневой папке мода), чтобы его можно было отличить от оригинала.

Для этого находим тег `<Title>` внутри которого находится название мода и изменяем:

`<Title>Lilith class</Title>` -> `<Title>Lilith class Translated</Title>`

---
Готово! 

Мод должен быть переведён на ваш язык, и его можно будет найти и выбрать.